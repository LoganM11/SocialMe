{% extends "base.html" %}


{% block nav_left_sect %}


{% endblock %}

{% block nav_right_sect %}
    <button onclick="location.href='{{ url_for('auth.logout') }}'">Logout</button>
{% endblock %}

{% block content_tents %}
    <div class="dash b">
        <div class="welcome-head">
            <div class="welcome"></div>
                <button class="welcome-but" autofocus onclick="iwantto('getupload')">Upload</button>
                <button class="welcome-but" onclick="iwantto('getdownload')">Download</button>
                <button class="welcome-but"  onclick="iwantto('getaudio')">Audio</button>    
                <button class="welcome-but"  onclick="iwantto('getcaption')">Caption</button>
        </div>
            <div class="upload-grid getupload animate-on-scroll">
                {% for account in user.accounts %}
                    <div class="account-card">
                        <form action="{{ url_for('views.delete_account', account_id=account.id) }}" method="POST" class="delete-form">
                            <button type="submit" class="delete">
                                <i id="delete-icon" class="fa-solid fa-trash"></i>
                            </button>
                        </form>      
                        <form action="{{ url_for('views.edit_account', account_id=account.id) }}" method="GET" class="edit-form">
                            <input class="c" type="text" name="account-name" value="{{ account.account_name }}">
                            <button type="submit" class="edit">
                                <i id="edit-icon" class="fa-solid fa-pen"></i>
                            </button>
                        </form>                   
                        <a href="{{ url_for('views.view_channel', account_id = account.id, status = 400) }}" class="idk idd">
                            <h1>{{ account.account_name }}</h1>
                        </a>                        
                        <div class="logo-grid">
                            {% set platform_numbers = [] %}
                            {% for channel in account.channels %}
                                {% if channel.platform_number not in platform_numbers %}
                                    {% set _ = platform_numbers.append(channel.platform_number) %}
                                    {% if channel.platform_number == 1 %}
                                        <div class="image-cont">
                                            <a href="https://www.instagram.com/{{ channel.uname }}" target="_blank">
                                                <img class="image" src="{{ url_for('static', filename=image_dict[1][0]) }}" alt="Instagram Logo">
                                            </a>
                                        </div>
                                    {% elif channel.platform_number == 20 %}
                                        <div class="image-cont">
                                            <a href="https://www.linkedin.com/in/{{ channel.uname }}" target="_blank">
                                                <img class="image" src="{{ url_for('static', filename=image_dict[2][0]) }}" alt="LinkedIn Logo">
                                            </a>
                                        </div>
                                    {% elif channel.platform_number == 3 %}
                                        <div class="image-cont">
                                            <a href="https://www.snapchat.com/add/{{ channel.uname }}" target="_blank">
                                                <img class="image" src="{{ url_for('static', filename=image_dict[3][0]) }}" alt="Snapchat Logo">
                                            </a>
                                        </div>
                                    {% elif channel.platform_number == 40 %}
                                        <div class="image-cont">
                                            <a href="https://www.tiktok.com/@{{ channel.uname }}" target="_blank">
                                                <img class="image" src="{{ url_for('static', filename=image_dict[4][0]) }}" alt="TikTok Logo">
                                            </a>
                                        </div>
                                    {% elif channel.platform_number == 50 %}
                                        <div class="image-cont">
                                            <a href="https://twitter.com/{{ channel.uname }}" target="_blank">
                                                <img class="image" src="{{ url_for('static', filename=image_dict[5][0]) }}" alt="X Logo">
                                            </a>
                                        </div>
                                    {% elif channel.platform_number == 6 %}
                                        <div class="image-cont">
                                            <a href="https://studio.youtube.com" target="_blank">
                                                <img class="image" src="{{ url_for('static', filename=image_dict[6][0]) }}" alt="YouTube Logo">
                                            </a>
                                        </div>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        
                            {% for num in range(1, 7) %}
                                {% if num not in platform_numbers %}
                                    {% if num == 1 %}
                                        <div class="image-cont">
                                            <a href="https://www.instagram.com/accounts/emailsignup/" target="_blank">
                                                <img class="image-grey" src="{{ url_for('static', filename=image_dict[1][0]) }}" alt="Instagram Sign Up">
                                            </a>
                                        </div>
                                    {% elif num == 20 %}
                                        <div class="image-cont">
                                            <a href="https://www.linkedin.com/signup" target="_blank">
                                                <img class="image-grey" src="{{ url_for('static', filename=image_dict[2][0]) }}" alt="LinkedIn Sign Up">
                                            </a>
                                        </div>
                                    {% elif num == 3 %}
                                        <div class="image-cont">
                                            <a href="https://accounts.snapchat.com/accounts/signup" target="_blank">
                                                <img class="image-grey" src="{{ url_for('static', filename=image_dict[3][0]) }}" alt="Snapchat Sign Up">
                                            </a>
                                        </div>
                                    {% elif num == 40 %}
                                        <div class="image-cont">
                                            <a href="https://www.tiktok.com/signup" target="_blank">
                                                <img class="image-grey" src="{{ url_for('static', filename=image_dict[4][0]) }}" alt="TikTok Sign Up">
                                            </a>
                                        </div>
                                    {% elif num == 50 %}
                                        <div class="image-cont">
                                            <a href="https://twitter.com/i/flow/signup" target="_blank">
                                                <img class="image-grey" src="{{ url_for('static', filename=image_dict[5][0]) }}" alt="X Sign Up">
                                            </a>
                                        </div>
                                    {% elif num == 6 %}
                                        <div class="image-cont">
                                            <a href="https://www.youtube.com/account" target="_blank">
                                                <img class="image-grey" src="{{ url_for('static', filename=image_dict[6][0]) }}" alt="YouTube Sign Up">
                                            </a>
                                        </div>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        </div>                        
                    </div> <!-- Ensures account-card is properly closed -->
                {% endfor %}
            
                <!-- Add Account Button -->
                <button id="add-account" class="account-card" onclick="location.href='/upload/create'">
                    <span>+</span>
                </button>
            </div> <!-- Ensures upload-grid is properly closed -->
            <div class="bottom getupload animate-on-scroll"></div>

            <script class="getupload">
                // Reverse the order of items in the grid
                const gridContainer = document.querySelector(".upload-grid");
                const items = Array.from(gridContainer.children);
                items.reverse().forEach(item => gridContainer.appendChild(item));
            </script>
            
        <form class="getFromTube getdownload animate-on-scroll" action="{{ url_for('views.getFromTube', user=user.id) }}" method="POST">
            <div class="inner-form" class="getFromTube">
                <div class="left">
                    <div class="d">
                        <input class="e" type="text" name="url" id="url" placeholder="Enter URL" oninput="fetchFormatsAndCheckQuality()">
                        <input class="c" type="text" id="formatt" name="format-id" value="">
                        <input class="c" type="text" id="ttype" name="download-type" value="">
                        <span class="f" onclick="window.open('https://www.youtube.com/results?search_query=', '_blank')"
                            title="Search YouTube">
                        <i class="fas fa-search g"></i> <!-- Font Awesome Search Icon -->
                        </span>
                    </div>
                    
                    <!-- Add this to include Font Awesome icons -->
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
                    <div class="rrow">
                        <div class="qquality-option" onclick="selectOption(this)">Only Video</div>
                    </div>
                    <div class="rrow">
                        <div class="qquality-option" onclick="selectOption(this)">Only Audio</div>
                    </div>
                    <div class="rrow">
                        <div class="qquality-option"  onclick="selectOption(this)">Merged Audio and Video</div>
                    </div>
                    <button class="qqq c" type="submit">Download</button>
                    <div class="loading-spinner h">
                        <span class="i" ></span>
                      </div>
                </div>
                <div class="quality">
                    <h2 class="qualllity">Video Quality</h2>
                    <div class="radios">
                        <div class="quality-option unavailable" data-available="false" onclick="selectQualityOption(this)">
                            144p
                        </div>
                        <div class="quality-option unavailable" data-available="false" onclick="selectQualityOption(this)">
                            240p
                        </div>
                        <div class="quality-option unavailable" data-available="false" onclick="selectQualityOption(this)">
                            360p
                        </div>
                        <div class="quality-option unavailable" data-available="false" onclick="selectQualityOption(this)">
                            480p
                        </div>
                        <div class="quality-option unavailable" data-available="false" onclick="selectQualityOption(this)">
                            720p
                        </div>
                        <div class="quality-option unavailable" data-available="false" onclick="selectQualityOption(this)">
                            1080p
                        </div>
                    </div>
                </div>
            </div>
        </form> 

        <script class="getdownload">
            const theid = document.getElementById("formatt")
            const thetype = document.getElementById("ttype")
            
            let selectedFormatId = '';
            let selectedOptionDiv = null;
            let selectedQualityDiv = null;
            
            function fetchFormatsAndCheckQuality() {
                if (!selectedOptionDiv) {
                    selectedOptionDiv = document.querySelector('.qquality-option');
                    thetype.value = selectedOptionDiv.textContent

                    if (selectedOptionDiv) {
                        selectOption(selectedOptionDiv); // Default to the first option if none selected
                    }
                }

                document.querySelector('.qqq').style.display = 'none';
                document.querySelector('.loading-spinner').style.display = '';
                
                const url = document.getElementById('url').value;
            
                const qualityOptions = document.querySelectorAll('.quality-option');

                qualityOptions.forEach(option => {
                    option.classList.add('unavailable');
                    option.removeAttribute('id','selectedd');
                    option.setAttribute('data-available', 'false');
                });

                fetch(`/get_formats/${encodeURIComponent(url)}`, { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                    // Fetch the available resolutions and IDs
                    const availableResolutions = data.map(format => ({
                        resolution: format.format, // Format/Resolution
                        id: format.id              // Format ID
                    }));

                    const qualityOptions = document.querySelectorAll('.quality-option');

                    // Update data-available and data-format-id attributes based on fetched formats
                    qualityOptions.forEach(option => {
                        const resolution = option.textContent.trim();
                        //console.log("Checking resolution:", resolution);

                        // Find the matching resolution in availableResolutions
                        const matchedFormat = availableResolutions.find(format => format.resolution === resolution);

                        if (matchedFormat) {
                            option.setAttribute('data-available', 'true');
                            option.setAttribute('data-format-id', matchedFormat.id); // Attach the format ID
                            //console.log(`Resolution available: ${resolution}, Format ID: ${matchedFormat.id}`);
                        } else {
                            option.setAttribute('data-available', 'false');
                            //console.log(`Resolution not available: ${resolution}`);
                        }
                    });

                        
                        // Update quality selection based on selected option
                        if (selectedOptionDiv) {
                            const selectedOption = selectedOptionDiv.textContent.trim();
                            //console.log("Selected option:", selectedOption);
            
                            if (selectedOption === 'Only Video' || selectedOption === 'Merged Audio and Video') {
                                qualityOptions.forEach(option => {
                                    if (option.getAttribute('data-available') === 'true') {
                                        option.classList.remove('unavailable');
                                        //console.log("Setting available:", option.textContent.trim());
                                    }
                                    let firstElement = document.querySelector(".quality-option:not(.unavailable)");
                                    if (firstElement) {
                                        firstElement.setAttribute('id', 'selectedd');
                                        selectedQualityDiv = firstElement;
                                        selectedFormatId = firstElement.getAttribute('data-format-id');
                                        theid.value = selectedFormatId

                                    }
                                });
                            } else if (selectedOption === 'Only Audio') {
                                const qualityyy = document.querySelector('.quality-selected');
                                qualityyy.classList.add('quality');
                                qualityyy.classList.remove('quality-selected');
                                qualityOptions.forEach(option => {
                                    option.classList.add('unavailable');
                                    //console.log("Setting unavailable:", option.textContent.trim());
                                });
                            }
                        }
                        
                        setSelectedFormatId();
                        

                        if (availableResolutions.length > 0) {
                            document.querySelector('.qqq').style.display = '';
                            document.querySelector('.loading-spinner').style.display = 'none';
                        } else {    
                            document.querySelector('.qqq').style.display = 'none';
                            document.querySelector('.loading-spinner').style.display = 'none';
                        }   
                    })
                    .catch(error => {
                        console.error('Error fetching formats:', error);
                    });
            }
            
            function selectOption(div) {
                if (div.textContent.trim() === 'Only Video' || div.textContent.trim() === 'Merged Audio and Video') {
                    const qualityyy = document.querySelector('.quality');
                    qualityyy.classList.add('quality-selected');

                    const qualityOptions = document.querySelectorAll('.quality-option');

                    qualityOptions.forEach(option => {
                        if (option.getAttribute('data-available') === 'true') {
                            option.classList.remove('unavailable');
                        }
                    });
                    let firstElement = document.querySelector(".quality-option:not(.unavailable)");
                    if (firstElement) {
                        firstElement.setAttribute('id', 'selectedd');
                        selectedQualityDiv = firstElement;
                        selectedFormatId = firstElement.getAttribute('data-format-id');
                        theid.value = selectedFormatId

                    }

                } else if (div.textContent.trim() === 'Only Audio') {
                    const qualityyy = document.querySelector('.quality');
                    qualityyy.classList.remove('quality-selected');
                    const qualityOptions = document.querySelectorAll('.quality-option');

                    qualityOptions.forEach(option => {
                        option.classList.add('unavailable');
                        option.removeAttribute('id','selectedd');
                    });

    
                }
                if (selectedOptionDiv) {
                    selectedOptionDiv.removeAttribute('id');
                }
                div.setAttribute('id', 'selectedd');
                selectedOptionDiv = div;
                thetype.value = selectedOptionDiv.textContent

            
                //console.log("Selected option div:", div.textContent.trim());
            }
            
            function selectQualityOption(div) {
                if (!div.classList.contains('unavailable')) {
                    if (selectedQualityDiv) {
                        selectedQualityDiv.removeAttribute('id');
                    }
                    div.setAttribute('id', 'selectedd');
                    selectedQualityDiv = div;
                    selectedFormatId = div.getAttribute('data-format-id');
                    theid.value = selectedFormatId

                }
            }
            
            function setSelectedFormatId() {
                if (selectedQualityDiv) {
                    selectedFormatId = selectedQualityDiv.getAttribute('data-format-id');
                    theid.value = selectedFormatId

                    //console.log("Selected format ID:", selectedFormatId);
                }
            }
            
            // Set all quality options to unavailable by default
            document.querySelectorAll('.quality-option').forEach(option => {
                option.classList.add('unavailable');
                option.setAttribute('data-available', 'false');
            });
            
            // Update the quality options as URL is typed
            document.getElementById('url').addEventListener('input', fetchFormatsAndCheckQuality);
            
            document.querySelectorAll('[name="option"]').forEach(option => {
                option.addEventListener('change', function() {
                    document.querySelectorAll('[name^="suboption"]').forEach(suboption => {
                        suboption.checked = false;
                        suboption.parentElement.style.display = 'none';
                    });
                    this.nextElementSibling.nextElementSibling.style.display = 'block';
                });
            });
        </script>
        
        <div class="thisisarow getaudio animate-on-scroll">
            <form class="left leftt" action="{{ url_for('views.audioEnhance', user=user.id) }}" method="POST" enctype="multipart/form-data">
                <h1 class="file-exist">Audio Enhancer - No File Uploaded</h1>
                <input class="c" name="audio" type="file" id="audioUpload" accept="audio/*">
                <div class="j">
                    <label for="audioUpload" class="upload-label">
                        Upload Audio
                    </label>
                    <button type="submit" id="enhanceAudio" class="hidden c">Enhance Audio</button>  
                </div>

            
                <div class="controls">
                    <label>Noise Reduction: 
                        <input name="noiseReduction" type="range" id="noiseReduction" min="0" max="1" step="0.05" value="0.2" oninput="updateValue(this)">
                        <span class="k" id="noiseReductionValue">0.2</span>
                        <span class="info" title="Reduces background noise. Higher values remove more noise but may distort speech.">ℹ️</span>
                    </label>
            
                    <label>Silence Threshold: 
                        <input name="silenceThreshold" type="range" id="silenceThreshold" min="-100" max="-10" step="1" value="-40" oninput="updateValue(this)">
                        <span class="k" id="silenceThresholdValue">-40</span>
                        <span class="info" title="Determines the loudness level considered 'silence.' Lower values detect more silence.">ℹ️</span>
                    </label>
            
                    <label>Min Silence Length: 
                        <input name="minSilenceLength" type="range" id="minSilenceLength" min="100" max="2000" step="100" value="500" oninput="updateValue(this)">
                        <span class="k" id="minSilenceLengthValue">500</span>
                        <span class="info" title="The minimum duration (ms) of silence required before a cut is made.">ℹ️</span>
                    </label>
            
                    <label>Padding: 
                        <input name="padding" type="range" id="padding" min="0" max="2000" step="100" value="500" oninput="updateValue(this)">
                        <span class="k" id="paddingValue">500</span>
                        <span class="info" title="Adds silence (ms) around detected speech to prevent choppy or sudden cuts.">ℹ️</span>
                    </label>
            
                    <label>Leeway: 
                        <input name="leeway" type="range" id="leeway" min="0" max="1000" step="50" value="150" oninput="updateValue(this)">
                        <span class="k" id="leewayValue">150</span>
                        <span class="info" title="Extra space (ms) left before a cut is made to ensure the ending of words dosen't get cut off.">ℹ️</span>
                    </label>
            

                </div>

            </form>
            <div class="left lefttt">
                <label class="big">Presets</label>
                <div class="divider" id="sevenfive">
                </div>
                <div class="presets">
                    <div class="select-animate"></div>
                    <div id="default" number="0" onclick="applyPreset('default')" >Default</div>
                    <div id="lowNoise" number="1" onclick="applyPreset('lowNoise')">Low Noise</div>
                    <div id="speech" number="2" onclick="applyPreset('speech')">Speech Focus</div>
                    <div id="aggressive" number="3" onclick="applyPreset('aggressive')">Aggressive Cut</div>
                    <div id="custom" number="4" onclick="applyPreset('custom')">Customize</div>
                </div>    
            </div>  
        </div>

        <script class="getaudio">
            // Function to add event listeners to all sliders
        function addSliderListeners() {
            // Select all range sliders in the document
            const sliders = document.querySelectorAll('input[type="range"]');

            // Loop through each slider
            sliders.forEach(slider => {
                // Add an event listener for when the slider's value changes
                slider.addEventListener('input', () => {
                    selectPreset("custom")
                    // Find the sibling element with the class "k" inside the same parent
                    const sibling = slider.parentNode.querySelector('.k');
                    if (sibling) {
                        // Update the sibling's textContent to reflect the slider's value
                        sibling.textContent = slider.value;
                    } else {
                        console.error(`No sibling with class "k" found for slider ID: ${slider.id}`);
                    }
                });
            });
        }

        // Call the function after the DOM has loaded
        document.addEventListener('DOMContentLoaded', addSliderListeners);

            document.getElementById('audioUpload').addEventListener('change', function() {
                console.log('Audio file input changed.');
                
                document.getElementById('enhanceAudio').style.display = 'block';
                console.log('Enhance Audio button is now visible.');
        
                document.querySelector('.upload-label').textContent = 'Change Audio';
                console.log('Upload label text changed.');
        
                const filename = this.files[0]?.name;
                console.log('Selected file name:', filename);
        
                if (filename) {
                    document.querySelector('.file-exist').textContent = 'Audio Enhancer - ' + filename;
                } else {
                    console.log('No file selected.');
                }
            });
        
        
            function applyPreset(type) {
                console.log('Applying preset:', type);
        
                const presets = {
                    default: { noiseReduction: 0.2, silenceThreshold: -40, minSilenceLength: 500, padding: 500, leeway: 150 },
                    lowNoise: { noiseReduction: 0.1, silenceThreshold: -50, minSilenceLength: 700, padding: 600, leeway: 200 },
                    speech: { noiseReduction: 0.3, silenceThreshold: -35, minSilenceLength: 300, padding: 400, leeway: 100 },
                    aggressive: { noiseReduction: 0.4, silenceThreshold: -30, minSilenceLength: 200, padding: 300, leeway: 50 },
                    custom: {} // User can adjust manually
                };
        
                if (presets[type]) {
                    for (let key in presets[type]) {
                        let slider = document.getElementById(key);
                        let sibling = slider.parentNode.querySelector(".k")
                        if (slider) {
                            slider.value = presets[type][key];
                            console.log(`Preset applied: ${key} = ${presets[type][key]}`);
                            sibling.textContent = slider.value;
                        } else {
                            console.log(`Slider for ${key} not found.`);
                        }
                    }
                } else {
                    console.log('Preset type not recognized:', type);
                }
        
                selectPreset(type);
            }
        
            function selectPreset(type) {
                console.log('Selecting preset:', type);
        
                const presets = document.querySelector('.presets').children;
        
                for (let i = 0; i < presets.length; i++) {
                    console.log('Checking preset:', presets[i].id);
                    if (presets[i].id === type) {
                        typeElement = presets[i];
                        break;
                    }
                }
        
                if (typeElement) {
                    console.log('Preset element found:', typeElement);
                    const animateElemnt = document.querySelector('.select-animate');
                    if (animateElemnt) {
                        const numberAttribute = typeElement.getAttribute('number');
                        console.log('Number attribute value:', numberAttribute);
                        animateElemnt.style.animation = 'none'; // Clears the previous animation
                        void animateElemnt.offsetWidth; // Triggers reflow to reapply animation
                        animateElemnt.style.animation = 'slide .5s ease-in-out forwards';    
                        // Add transition property for smooth animation
                        animateElemnt.style.translate = '0px ' + ((numberAttribute * 39)) + 'px';



                        console.log('Animation updated. Top:', animateElemnt.style.top);
                    } else {
                        console.log('Animation element (.select-animate) not found.');
                    }
                } else {
                    console.log('Preset element not found for type:', type);
                }
            }
        
            window.onload = function() {
                console.log('Window loaded. Applying default preset.');
                applyPreset('default'); 
            };
        
        </script>
        
        <div class="thisisarow getcaption animate-on-scroll">
            <form class="left leftt" action="{{ url_for('views.captioning', user=user.id) }}" method="POST" enctype="multipart/form-data">
                <h1 class="file-exist l">Caption Generator - No File Uploaded</h1>
                <input name="audio" type="file" id="captionUpload" accept="audio/*" style="display: none;">
                <div class="j">
                    <label for="captionUpload" class="upload-label">
                        Upload Audio
                    </label>
                    <button id="enhanceCaption" class="hidden c">Generate Captions</button>      
                </div>
                <div name="type" class="radios">
                    <label>
                        <input type="radio" name="radio" value="1" checked>
                        Words Per Caption
                    </label>
                    <label>
                        <input type="radio" name="radio" value="5">
                        Characters Per Caption
                    </label>
                    <label>
                        <input type="radio" name="radio" value="2">
                        Vowels Per Caption
                    </label>    
                </div>
                <div class="thisisaroww">
                    <input type="range" name="captionRange" id="captionRange" min="1" max="10" step="1" value="1" oninput="updateValue(this)">
                    <span class="k" id="captionRangeValue">1</span>    
                </div>

            </form>

        <script>
            document.getElementById('captionUpload').addEventListener('change', function() {
                
                document.getElementById('enhanceCaption').style.display = 'block';
        
                document.querySelector('.upload-label').textContent = 'Change Audio';
        
                const filename = this.files[0]?.name;

                if (filename) {
                    document.querySelector('.file-exist').textContent = 'Audio Enhancer - ' + filename;
                } else {
                    pass
                }
            });

            function updateValue(slider) {
                const value = slider.value;
                const myguy = document.getElementById("captionRangeValue");
                if (myguy) {
                    myguy.textContent = value;
                }
            }
            // Add an event listener to all radio buttons in the group
            const radios = document.querySelectorAll('input[name="radio"]');

            radios.forEach((radio) => {
                radio.addEventListener('change', () => {
                    if (radio.checked) {
                        const myguysOne = document.getElementById("captionRange");
                        const myguy = document.getElementById("captionRangeValue");

                        myguysOne.max = radio.value*10; // Set ariaValueMax to the selected radio value
                        myguysOne.value = radio.value
                        myguy.textContent = radio.value;

                    }
                });
            });
            
            // Function to be executed when the page loads
            function onPageLoad() {
                // Add your logic here
            }

            // Attach the function to the window.onload event
            window.onload = onPageLoad;

        </script>

        
        </div>
    
        <div class="loading-spinnerr m">
            <span class="i"></span>
            <div class="phrase" id="phrase">Processing ...</div>
        </div>
    </div>
    
    <script>
        let pannel = ""; // Declare 'pannel' as a global variable

        const spinner = document.querySelector(".loading-spinnerr");

        function checkStatus() {
            fetch(`/process_status/{{ user.id }}`)
                .then(response => response.json())
                .then(data => {
                    console.log(data.status);
                    if (data.status === "pending") {
                        spinner.style.display = "flex"; // Show the spinner
                    } else {
                        spinner.style.display = "none"; // Hide the spinner
                    }
                    setTimeout(checkStatus, 2000); // Poll every 2 seconds
                })
                .catch(error => console.error("Error fetching status:", error));
        }
        
        checkStatus();
        

        // Function to get elements by multiple class names and combine them into a single list
        function getElementsByClasses(...classNames) {
            const combinedList = [];
            classNames.forEach(className => {
                const elements = document.querySelectorAll(`.${className}`);
                if (elements.length > 0) {
                    console.log(`[getElementsByClasses] ${elements.length} elements found for class '${className}'`);
                }
                elements.forEach(element => combinedList.push(element));
            });
            return combinedList;
        }
    
        const combinedList = getElementsByClasses('getupload', 'getdownload', 'getaudio', 'getcaption');
    
        function iwantto(targetClassName) {
            console.log(`[iwantto] Activating panel for class '${targetClassName}'`);
            pannel = targetClassName; // Update the global 'pannel' variable
    
            const actionMap = {
                getcaption: "caption",
                getdownload: "download",
                getaudio: "audio",
                getupload: "upload"
            };
    
            const newPath = actionMap[targetClassName] || "upload";
            setRe(newPath);
    
            combinedList.forEach(element => {
                if (element.tagName.toLowerCase() === 'script') {
                    if (element.classList.contains(targetClassName)) {
                        if (element.getAttribute('data-disabled') === 'true') {
                            const newScript = document.createElement('script');
                            newScript.src = element.getAttribute('data-src');
                            document.body.appendChild(newScript);
                            element.setAttribute('data-disabled', 'false');
                            console.log(`[iwantto] Script for '${targetClassName}' enabled`);
                        }
                    } else {
                        if (!element.getAttribute('data-disabled')) {
                            element.setAttribute('data-src', element.src);
                            element.remove();
                            element.setAttribute('data-disabled', 'true');
                            console.log(`[iwantto] Script for non-target class disabled`);
                        }
                    }
                } else {
                    if (element.classList.contains(targetClassName)) {
                        element.style.display = '';
                    } else {
                        element.style.display = 'none';
                    }
                }
            });
        }
    
        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
                const isGetUploadActive = pannel === 'getupload';
                const shouldSkip = isGetUploadActive && entry.target.classList.contains('getdownload');
    
                if (shouldSkip) {
                    console.log(`[Observer] Skipping 'getdownload' while 'getupload' is active`);
                    return; // Skip 'getdownload' divs when 'getupload' is active
                }
    
                if (entry.isIntersecting) {
                    entry.target.style.display = "";
                    entry.target.classList.add("animate-in");
                    console.log(`[Observer] '${entry.target.className}' in view and animated in`);
                } else {
                    entry.target.classList.remove("animate-in");
                    setTimeout(() => {
                        entry.target.style.display = "none";
                    }, 500);
                    console.log(`[Observer] '${entry.target.className}' out of view and hidden`);
                }
            });
        });
    
        const elements = document.querySelectorAll(".animate-on-scroll");
        console.log(`[Observer] Observing ${elements.length} elements`);
        elements.forEach(el => observer.observe(el));
    
        document.addEventListener('DOMContentLoaded', () => {
            pannel = "getupload"; // Initialize the global 'pannel' variable
            console.log(`[DOMContentLoaded] Initialized with default panel '${pannel}'`);
            iwantto(pannel);
        });
    
        function setRe(newPath) {
            console.log(`[setRe] URL updated to '/${newPath}'`);
            const newUrl = `${window.location.origin}/${newPath}`;
            history.pushState(null, '', newUrl);
        }
    </script>
    
{% endblock %}
